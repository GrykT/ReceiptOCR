1. システム全体概要
目的
iPhoneやPCの外付けカメラからリアルタイムで取得したレシート画像を入力とし、OCRライブラリ（例：Tesseract OCR）を利用してレシート上の文字（特に日付、店名、使用金額など）を認識、抽出、構造化データ（JSON、CSV等）として保存する。

主要な処理フロー

カメラからの映像ストリーム取得
画像キャプチャと前処理
OCR処理による文字認識
認識結果から必要項目（例：日付、店名、金額）の抽出
抽出データの整形と保存
2. モジュール毎の仕様
2.1 カメラ入力モジュール
機能

リアルタイムでカメラから画像を取得する。
iPhoneカメラ（可能であればiOS向けWebアプリ／ネイティブアプリ）またはPCの外付けカメラ（例：OpenCVを利用）から入力可能とする。
実装例

PCの場合： PythonのOpenCVライブラリを用いて、USBカメラの映像ストリームを取得。
iPhoneの場合： WebRTCやカメラAPIを利用したWebアプリ、もしくはSwiftでのネイティブアプリで映像を取得し、サーバーに送信する仕組み（初期プロトタイプではPCでの検証を優先してもよい）。
留意点

取得する画像解像度、フレームレートの調整。
ユーザー操作（キャプチャボタン）による静止画の取得も検討。
2.2 画像前処理モジュール
機能

OCR精度向上のため、入力画像に対して前処理を実施。
ノイズ除去、グレースケール変換、二値化、傾き補正などの処理を行う。
実装例

OpenCVを用いたフィルタリング（ガウシアンブラー、適応的閾値処理）
必要に応じて、画像の回転補正やコントラスト調整。
留意点

前処理パラメータはレシートの種類や撮影環境に応じて調整可能にする。
複数の前処理パターンを試し、最適なものを選択できる仕組み（設定ファイルやGUIでのパラメータ変更）。
2.3 OCR処理モジュール
機能

前処理済みの画像に対してOCRライブラリ（例：Tesseract OCR）を適用し、文字列情報を取得する。
実装例

PythonでTesseract（pytesseract）を呼び出し、OCRを実行。
認識言語の設定（日本語対応の場合は、日本語言語パックの導入）。
留意点

認識精度が低い場合の再試行や、画像の再キャプチャ処理の検討。
可能であれば、OCRの結果と元画像をユーザーにフィードバックして確認・修正を促す仕組みを追加。
2.4 データ抽出・整形モジュール
機能

OCR結果の生テキストから、必要な項目（例：日付、店名、金額）を正規表現やパターンマッチングで抽出する。
抽出した項目を定義済みのデータフォーマットに変換する。
実装例

正規表現パターンを用いて「YYYY/MM/DD」や「MM/DD」などの形式の日付、店舗名の候補文字列、数値（金額、数字＋カンマまたは円記号付き）を抽出。
抽出結果をJSONオブジェクトやCSVレコードにマッピングする。
留意点

レシートのレイアウトが多様なため、柔軟な抽出ロジックを実装する。
不正確な認識の場合に備え、抽出結果の信頼度評価や、ユーザーによる修正インターフェースを検討。
2.5 出力・保存モジュール
機能

抽出したデータを任意のデータ形式に変換し、ファイルやデータベースに保存する。
保存先：ローカルファイル（JSON, CSV）、もしくは簡易なデータベース（SQLiteなど）。
実装例

JSON形式で出力し、時間スタンプ付きのファイル名で保存。
GUIに結果を表示し、再編集が可能な仕組みを提供する場合、Webフロントエンド等と連携。
留意点

保存形式は後続の処理（例：LLMによる分析、他システムへの連携）に適したものにする。
エラーハンドリングと保存成功のフィードバック。
3. ユーザーインターフェース（UI）設計
基本要件

カメラ映像のプレビュー画面
キャプチャボタン：ユーザーが静止画を取得するためのインターフェース
OCR結果の表示画面：認識された文字、抽出結果（例：日付、店名、金額）を表示し、必要に応じて編集・修正可能にする
保存ボタン：抽出・整形されたデータを保存する
実装例

PC向け：PythonのTkinterやPyQtなどで簡易GUIを構築
Webベース：FlaskやDjangoをバックエンドとして、JavaScriptでリアルタイム映像プレビューと操作画面を構築
4. その他技術的留意点
デバッグ・ログ機能

OCR処理結果、前処理パラメータ、エラー情報などをログ出力して、問題発生時に追跡可能とする
拡張性

プロトタイプ1は個人利用を想定しているため、軽量な構成とするが、将来的なプロトタイプ2・3への移行を考慮し、モジュール間のインターフェース（API設計）を明確にする
環境依存性

実行環境（OS、カメラデバイス、Pythonバージョン）に依存する部分をドキュメント化し、セットアップ手順を明示する
5. 開発スケジュール（例）
要件定義と設計（1週間）

仕様書の確定、使用するライブラリ・ツールの選定
プロトタイプ実装（2〜3週間）

カメラ入力、前処理、OCR、データ抽出、UIの各モジュールを個別に実装
各モジュールの単体テスト実施
統合テスト・デバッグ（1〜2週間）

各モジュールを統合して動作確認
ユーザーによる操作テスト、フィードバック反映
成果物のドキュメント化・評価

インストール手順、使用方法、既知の問題点の整理